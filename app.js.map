{"version":3,"sources":["webpack:///./src/app.js","webpack:///./src/app.state.js","webpack:///./src/model/protocol.js","webpack:///./src/view/signing-widget.js","webpack:///./src/app.embed.js","webpack:///./src/lib/crud-array.js","webpack:///./src/model/authenticator.js","webpack:///./src/model/signing-flow.js","webpack:///./src/model/signing-context.js","webpack:///./src/data/protocols.js","webpack:///./src/data/wallets.js","webpack:///./src/view/tx-description.js","webpack:///./src/view/handler-form.js","webpack:///./src/view/account-input.js","webpack:///./src/view/handler-selector.js","webpack:///./src/view/network-selector.js","webpack:///./src/view/redirection-form.js","webpack:///./src/view/qr-code-switcher.js","webpack:///./src/view/qr-code-canvas.js","webpack:///./src/view/redirection-button.js","webpack:///./src/view/tx-result-view.js","webpack:///./src/view/xdr-area.js","webpack:///./src/app.full.js","webpack:///./src/lib/navigation.js","webpack:///./src/view/anti-tamper.js"],"names":["CosmicLinkApp","constructor","params","mode","Embed","Full","require","module","exports","type","StellarSdk","CrudArray","Authenticator","Protocol","SigningFlow","protocols","ingest","authenticators","AppState","super","this","$import","testAccount","get","keypair","Keypair","fromSecret","authenticator","$trigger","interrupt","console","log","proto","prototype","$define","authenticatorId","target","cosmicLink","automaticRedirection","sign","$on","current","previous","onExit","LiveObject","redirection","textarea","qrCode","$pick","lock","View","TxDescription","HandlerForm","RedirectionForm","signingFlow","txDescription","handlerForm","redirectionForm","SigningWidget","state","signingWidget","$pull","x","LiveArray","xeach","hide","Class","$store","key","ingestJson","toJson","toObject","map","JSON","stringify","collection","id","item","put","string","parse","want","delete","push","find","index","findIndex","splice","$listen","$ignore","protocol","buttonText","name","CosmicLink","config","TxResult","isEmbedded","SigningContext","open","uri","location","replace","window","parent","postMessage","signRequest","returned","resolved","signed","_","initialCosmicLink","needSource","tdesc","source","lastAccountId","accountId","async","lockSource","Error","needNetwork","network","lockNetwork","horizon","clone","query","resolveRequest","error","requestToUri","requestToXdr","forCosmicLink","then","result","validated","resolve","networkName","length","getAddress","substr","passphrase","networkPassphrase","setupNetwork","friendbot","testnet","withConfig","getLedgerModule","ledger","default","getTrezorModule","trezor","register","cosmiclink","url","ledgerwallet","connect","publicKey","transaction","disconnect","trezorwallet","sep0007","sep7","encodeURIComponent","stellarlab","encodedXdr","xdr","copy","pubkey","isAccountEmpty","catch","wallets","Keybase","federation","LedgerWallet","TrezorWallet","StellarAuthenticator","Lobstr","StellarTerm","Sep7Wallet","StellarLaboratory","StellarLaboratoryView","TestAccount","CopyPasteXdr","html","format","operations","htmlDescription","$customDefine","status","descriptionDiv","grab","context","signers","signatures","AccountInput","HandlerSelector","NetworkSelector","handlerSelector","accountInput","networkSelector","copyContent","$link","onclick","readonly","$ref","accountIdInput","user","federationPattern","federationRegexp","RegExp","match","helpers","filter","isTxHandlerValid","txHandlerId","filteredHandlers","some","txHandler","handler","wantNetwork","toOption","value","isCustom","timeout","QrCodeSwitcher","RedirectionButton","TxResultView","XdrArea","redirectionButton","xdrArea","qrCodeSwitcher","className","message","scrollTo","innerHeight","QrCodeCanvas","canvas","switch","showQrCode","disabled","QrCode","scale","Math","max","floor","sqrt","toCanvas","margin","getContext","clearRect","width","height","clearQr","linkAction","action","noLinkAction","shortName","response","txResult","toLi","any","domNode","sep7Utils","Navigation","AntiTamper","AppFull","selectedTabId","origin","pathname","navigation","title","view","selectedTabView","isSep7Supported","isWebHandlerSupported","antiTamper","copyHeader","registerSep7Handler","currentPageUrl","href","split","registerWebHandler","tab","hash","tabs","from","toNavigationLink","link","t","baseUrl","set","antiTamperHash","makeHash","size","alphabet","i","random","charAt"],"mappings":"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","file":"app.js","sourcesContent":["\"use strict\"\n/**\n * CosmicLink application.\n */\n\n/* Definiton */\nclass CosmicLinkApp {\n  constructor (params) {\n    if (params.mode === \"embed\") {\n      return new CosmicLinkApp.Embed(params)\n    } else {\n      return new CosmicLinkApp.Full(params)\n    }\n  }\n}\n\n/* Exports */\nCosmicLinkApp.Embed = require(\"./app.embed\")\nCosmicLinkApp.Full = require(\"./app.full\")\nmodule.exports = CosmicLinkApp\n","\"use strict\"\n/**\n * CosmicLinkApp.State\n * */\nconst { type } = require(\"@kisbox/utils\")\n\nconst { StellarSdk } = require(\"@cosmic-plus/base\")\n\nconst CrudArray = require(\"./lib/crud-array\")\n\nconst Authenticator = require(\"./model/authenticator\")\nconst Protocol = require(\"./model/protocol\")\nconst SigningFlow = require(\"./model/signing-flow\")\n\n/* Data */\n\nAuthenticator.protocols = new CrudArray(Protocol)\nAuthenticator.protocols.ingest(require(\"./data/protocols\"))\nconst authenticators = new CrudArray(Authenticator)\nauthenticators.ingest(require(\"./data/wallets\"))\n\n/* Definition */\n\nclass AppState extends SigningFlow {\n  constructor (params) {\n    super(params)\n\n    this.$import(params, [\n      \"automaticRedirection\",\n      \"authenticators\",\n      \"authenticatorId\",\n      \"showQrCode\"\n    ])\n\n    // Setup test account\n    const testAccount = this.authenticators.get(\"TestAccount\")\n    testAccount.keypair = StellarSdk.Keypair.fromSecret(params.testAccount)\n    if (this.authenticator === testAccount) {\n      this.$trigger(\"authenticator\")\n    }\n\n    // Prevent UI loading\n    if (this.interrupt === true) throw \"redirect\"\n\n    // Beta debugging\n    // eslint-disable-next-line no-console\n    console.log(\"State:\", this)\n  }\n}\n\n/* Defaults */\nconst proto = AppState.prototype\nproto.authenticators = authenticators\n\n/* Computations */\n\nproto.$define(\n  \"authenticator\",\n  [\"authenticators\", \"authenticatorId\"],\n  function () {\n    return this.authenticators.get(this.authenticatorId)\n  }\n)\n\nproto.$define(\n  \"interrupt\",\n  [\"automaticRedirection\", \"cosmicLink\", \"authenticator\", \"target\"],\n  function () {\n    if (type(this.target) !== \"string\") return\n\n    if (this.cosmicLink && this.automaticRedirection) {\n      this.sign()\n      return true\n    }\n  }\n)\n\n/* Events */\nproto.$on(\"authenticator\", function (current, previous) {\n  if (previous && previous.onExit) {\n    previous.onExit()\n  }\n})\n\n/* Export */\nmodule.exports = AppState\n","\"use strict\"\n/**\n * Protocol\n */\nconst { LiveObject } = require(\"@kisbox/model\")\n\n/* Definition */\n\nclass Protocol extends LiveObject {\n  constructor (params) {\n    super()\n\n    // Defaults\n    this.redirection = true\n    this.textarea = false\n    this.qrCode = true\n\n    this.$pick(params, [\n      \"id\",\n      // Values\n      \"redirection\",\n      \"textArea\",\n      \"qrCode\",\n      \"buttonText\",\n      // Actions\n      \"getAddress\",\n      \"resolveRequest\",\n      \"requestToUri\",\n      \"requestToXdr\",\n      \"signRequest\",\n      \"onExit\"\n    ])\n  }\n\n  async resolveRequest (cosmicLink) {\n    await cosmicLink.lock()\n    return cosmicLink\n  }\n}\n\n/* Export */\nmodule.exports = Protocol\n","\"use strict\"\n/**\n * Signing Widget\n * */\nconst { View } = require(\"@kisbox/browser\")\n\nconst TxDescription = require(\"./tx-description\")\nconst HandlerForm = require(\"./handler-form\")\nconst RedirectionForm = require(\"./redirection-form\")\n\n/* Definition */\n\nclass SigningWidget extends View {\n  constructor (signingFlow) {\n    super(`\n<section class=\"SigningWidget\">\n  <h2>Stellar Transaction Request</h2>\n  <hr>\n\n  <section>\n    <h3>Step 1: Check the Transaction</h3>\n    %txDescription\n  </section>\n  <hr>\n\n  <section>\n    <h3>Step 2: Select a Signing Method</h3>\n    %handlerForm\n  </section>\n  <hr>\n\n  <section>\n    <h3>Step 3: Sign the Transaction</h3>\n    %redirectionForm\n  </section>\n    `)\n\n    // Components\n    this.txDescription = new TxDescription(signingFlow)\n    this.handlerForm = new HandlerForm(signingFlow)\n    this.redirectionForm = new RedirectionForm(signingFlow)\n  }\n}\n\n/* Export */\nmodule.exports = SigningWidget\n","\"use strict\"\n/**\n * Widget interface initialization.\n */\nconst { View } = require(\"@kisbox/browser\")\n\nconst AppState = require(\"./app.state\")\nconst SigningWidget = require(\"./view/signing-widget\")\n\n/* Definition */\n\nclass AppEmbed extends View {\n  constructor (params) {\n    super(`\n<div class=\"CosmicLinkApp\" %hidden>\n  <main>\n    <hr>\n    %signingWidget\n  </main>\n</div>\n    `)\n\n    this.state = new AppState(params)\n    this.signingWidget = new SigningWidget(this.state)\n    this.$pull(\"route\", this.state, \"query\", (x) => x || \"\")\n  }\n}\n\n/* Export */\nmodule.exports = AppEmbed\n","\"use strict\"\n/**\n * CrudArray\n */\nconst { LiveArray } = require(\"@kisbox/model\")\nconst { xeach, hide } = require(\"@kisbox/helpers\")\n\n/* Definition */\n\nclass CrudArray extends LiveArray {\n  constructor (Class) {\n    super()\n    hide(this, \"Class\", Class)\n  }\n\n  /* Storage */\n  $store (target, key) {\n    if (key in target) this.ingestJson(target[key])\n    this.$on(\"$change\", () => target[key] = this.toJson())\n  }\n\n  /* Formats */\n  toObject () {\n    return this.map((x) => x.toObject())\n  }\n\n  toJson () {\n    return JSON.stringify(this.toObject())\n  }\n\n  ingest (collection) {\n    xeach(collection, (params, id) => {\n      const item = this.put(params)\n      if (!item.id) item.id = id\n    })\n    // collection.forEach(params => this.put(params))\n  }\n\n  ingestJson (string) {\n    this.ingest(JSON.parse(string))\n  }\n\n  /* Primitives */\n  put (params) {\n    const item = want(this.Class, params)\n    this.delete(item.id)\n    this.push(item)\n    return item\n  }\n\n  get (id) {\n    return this.find((x) => x.id === id)\n  }\n\n  delete (id) {\n    const index = this.findIndex((x) => x.id === id)\n    if (index !== -1) this.splice(index, 1)\n  }\n}\n\n/* Events */\nconst proto = CrudArray.prototype\n\nproto.$on(\"$add\", function ([item]) {\n  this.$listen(item, \"$set\", () => {\n    this.$trigger(\"$change\")\n  })\n})\n\nproto.$on(\"$remove\", function ([item]) {\n  this.$ignore(item, \"$set\")\n})\n\n/* Helpers */\n\nfunction want (Class, params) {\n  return params instanceof Class ? params : new Class(params)\n}\n\n/* Export */\nmodule.exports = CrudArray\n","\"use strict\"\n/**\n * Authenticator\n */\nconst Protocol = require(\"./protocol\")\n\n/* Definition */\n\nclass Authenticator extends Protocol {\n  constructor (params) {\n    const protocol = Authenticator.protocols.get(params.protocol)\n    super(protocol)\n    delete this.id\n\n    this.$import(params, [\n      \"id\",\n      // Values\n      \"name\",\n      \"protocol\",\n      \"url\",\n      \"federation\",\n      \"target\",\n      \"needSource\",\n      \"needNetwork\"\n    ])\n\n    if (!this.buttonText && this.redirection)\n      this.buttonText = \"Go to \" + this.name\n  }\n}\n\n/* Export */\nmodule.exports = Authenticator\n","\"use strict\"\n/**\n * Signing Flow\n **/\nconst { CosmicLink, config } = require(\"cosmic-lib\")\nconst TxResult = require(\"@cosmic-plus/tx-result\")\n\nconst { isEmbedded } = require(\"@kisbox/helpers\")\n\nconst SigningContext = require(\"./signing-context\")\n\n/* Definition */\n\nclass SigningFlow extends SigningContext {\n  constructor (params) {\n    super(params)\n  }\n\n  open () {\n    if (!this.uri) return\n\n    // TODO: use an opening callback instead?\n    if (\n      isEmbedded\n      && (this.authenticator.target === \"new\"\n        || this.authenticator.target === \"external\")\n    ) {\n      open(this.uri)\n      window.parent.postMessage(\"close\", \"*\")\n    } else {\n      location.replace(this.uri)\n    }\n  }\n\n  async sign () {\n    if (!this.authenticator.signRequest) return null\n\n    const returned = await this.authenticator.signRequest(this.resolved)\n    this.signed = returned || this.resolved\n  }\n}\n\n/* Computations */\nconst proto = SigningFlow.prototype\n\nproto.$on([\"open\", \"cosmicLink\"], function (_, initialCosmicLink) {\n  const cosmicLink = initialCosmicLink || this.cosmicLink\n  if (this.needSource && !cosmicLink.tdesc.source) {\n    this.lastAccountId = this.accountId\n  }\n})\n\nproto.$define(\n  \"resolved\",\n  [\"authenticator\", \"accountId\", \"network\", \"horizon\"],\n  async function () {\n    if (!this.cosmicLink) return\n\n    if (this.needSource && !(this.lockSource || this.accountId)) {\n      return new Error(\"Please set a source account\")\n    }\n    if (this.needNetwork) {\n      if (!(this.network || this.lockNetwork)) {\n        return new Error(\"Please set a network\")\n      } else if (!this.horizon) {\n        return new Error(\"Please set an Horizon address\")\n      }\n    }\n\n    const clone = new CosmicLink(this.cosmicLink.query)\n    config.source = this.accountId\n    config.network = this.network\n\n    try {\n      return await this.authenticator.resolveRequest(clone)\n    } catch (error) {\n      error.cosmicLink = clone\n      throw error\n    }\n  }\n)\n\nproto.$on(\"authenticator\", function () {\n  this.signed = null\n})\n\nproto.$define(\"uri\", [\"resolved\"], function () {\n  if (!this.resolved) {\n    return this.authenticator.uri\n  } else if (this.authenticator.requestToUri) {\n    return this.authenticator.requestToUri(this.resolved, this.authenticator)\n  } else {\n    return null\n  }\n})\n\nproto.$define(\"xdr\", [\"resolved\"], function () {\n  if (this.resolved && this.authenticator.requestToXdr) {\n    return this.authenticator.requestToXdr(this.resolved, this.authenticator)\n  } else {\n    return null\n  }\n})\n\nproto.$define(\"action\", [\"resolved\"], function () {\n  if (this.authenticator.signRequest) {\n    return () => this.sign()\n  } else {\n    return () => this.open()\n  }\n})\n\nproto.$on(\"signed\", function () {\n  if (this.signed) {\n    this.query = this.signed.query\n  }\n})\n\nproto.$define(\"result\", [\"signed\"], function () {\n  if (!this.signed) return this.signed\n\n  return TxResult.forCosmicLink(this.signed).then((result) => {\n    if (result.validated) {\n      window.parent.postMessage(\"close\", \"*\")\n    }\n    return result\n  })\n})\n\n/* Export */\nmodule.exports = SigningFlow\n","\"use strict\"\n/**\n * Signing Context\n **/\nconst { CosmicLink, resolve, config } = require(\"cosmic-lib\")\nconst { LiveObject } = require(\"@kisbox/model\")\n\n/* Definition */\n\nclass SigningContext extends LiveObject {\n  constructor (params) {\n    super()\n\n    /* Defaults */\n    this.network = \"public\"\n    this.accountId = null\n\n    /* Imports */\n    this.$import(params, [\n      \"network\",\n      \"horizon\",\n      \"accountId\",\n      \"lastAccountId\",\n      \"authenticator\",\n      \"query\",\n      \"cosmicLink\"\n    ])\n  }\n}\n\n/* Computations: inputs */\nconst proto = SigningContext.prototype\n\nproto.$on(\"network\", function () {\n  // Turns passphrases into network names. (e.g: \"public\")\n  const name = resolve.networkName(this.network)\n  if (this.network !== name) {\n    this.network = name\n    return\n  }\n})\n\nproto.$define(\"horizon\", [\"network\"], function () {\n  return (\n    resolve.horizon(this.network)\n    || this.cosmicLink && this.cosmicLink.tdesc.horizon\n    || \"\"\n  )\n})\n\nproto.$define(\"cosmicLink\", [\"query\"], function () {\n  if (this.query && this.query.length > 1) {\n    return new CosmicLink(this.query)\n  } else {\n    return null\n  }\n})\n\nproto.$define(\"query\", [\"cosmicLink\"], function () {\n  if (this.cosmicLink) {\n    return this.cosmicLink.query\n  } else {\n    return null\n  }\n})\n\n/* Computations: intermediate */\n\nproto.$define(\"needSource\", [\"authenticator\"], function () {\n  if (this.authenticator) {\n    return !!this.authenticator.needSource\n  }\n})\n\nproto.$define(\"needNetwork\", [\"authenticator\"], function () {\n  if (this.authenticator) {\n    return !!this.authenticator.needNetwork\n  }\n})\n\nproto.$define(\"lockSource\", [\"cosmicLink\"], function () {\n  if (this.cosmicLink) {\n    return !!this.cosmicLink.tdesc.source\n  }\n})\n\nproto.$define(\"lockNetwork\", [\"cosmicLink\"], function () {\n  if (this.cosmicLink) {\n    return !!this.cosmicLink.tdesc.network\n  }\n})\n\nproto.$on(\"authenticator\", function (_, previous) {\n  if (previous.getAddress) {\n    this.accountId = null\n  }\n})\n\nproto.$on([\"authenticator\", \"cosmicLink\"], function () {\n  if (this.authenticator.getAddress) {\n    this.accountId = this.authenticator.getAddress()\n  } else if (this.lockSource) {\n    this.accountId = this.cosmicLink.tdesc.source\n  } else if (!this.accountId) {\n    this.accountId = this.lastAccountId\n  }\n})\n\nproto.$define(\"network\", [\"cosmicLink\"], function () {\n  if (this.lockNetwork) {\n    return this.cosmicLink.tdesc.network\n  } else {\n    return this.network || \"public\"\n  }\n})\n\n/* Events: intermediate */\n\nproto.$on(\"horizon\", function () {\n  if (this.horizon.length > 4 && this.horizon.substr(0, 4) !== \"http\") {\n    this.horizon = `https://${this.horizon}`\n    return\n  }\n\n  // Save network/horizon association\n  const passphrase = resolve.networkPassphrase(this.network)\n  config.setupNetwork(this.network, this.horizon, passphrase)\n})\n\n/* Export */\nmodule.exports = SigningContext\n","\"use strict\"\n/**\n * Wallet protocols.\n *\n * Properties:\n *\n * - getAddress\n * - resolveRequest\n * - signRequest\n * - requestToUri\n * - requestToXdr\n * - onExit\n *\n * @exports protocols\n * @private\n */\nconst protocols = exports\n\nconst { friendbot } = require(\"@cosmic-plus/base\")\nconst cosmicLib = require(\"cosmic-lib\")\nconst testnet = cosmicLib.withConfig({ network: \"test\" })\n\n/* Data */\n\nprotocols.cosmiclink = {\n  resolveRequest (cosmicLink) {\n    return cosmicLink\n  },\n  requestToUri (cosmicLink, authenticator) {\n    return `${authenticator.url}${cosmicLink.query}`\n  }\n}\n\nprotocols.ledgerwallet = {\n  buttonText: \"Sign with Ledger Wallet\",\n  qrCode: false,\n  async getAddress () {\n    const ledger = await getLedgerModule()\n    await ledger.connect()\n    return ledger.publicKey\n  },\n  async signRequest (cosmicLink) {\n    const ledger = await getLedgerModule()\n    await ledger.sign(cosmicLink.transaction)\n  },\n  async onExit () {\n    const ledger = await getLedgerModule()\n    ledger.disconnect()\n  }\n}\n\nprotocols.trezorwallet = {\n  buttonText: \"Sign with Trezor Wallet\",\n  qrCode: false,\n  async getAddress () {\n    const trezor = await getTrezorModule()\n    await trezor.connect()\n    return trezor.publicKey\n  },\n  async signRequest (cosmicLink) {\n    const trezor = await getTrezorModule()\n    await trezor.sign(cosmicLink.transaction)\n  },\n  async onExit () {\n    const trezor = await getTrezorModule()\n    trezor.disconnect()\n  }\n}\n\nprotocols.sep0007 = {\n  requestToUri (cosmicLink, authenticator) {\n    const uri = cosmicLink.sep7\n    const endpoint = \"web+stellar:\"\n    if (authenticator.url !== endpoint) {\n      const sep7 = encodeURIComponent(uri)\n      return `${authenticator.url}${sep7}`\n    } else {\n      return uri\n    }\n  }\n}\n\nprotocols.stellarlab = {\n  async requestToUri (cosmicLink, authenticator) {\n    const encodedXdr = encodeURIComponent(cosmicLink.xdr)\n    let query = `${encodedXdr}`\n\n    if (cosmicLink.network === \"public\" || cosmicLink.network === \"test\") {\n      query += `&network=${cosmicLink.network}`\n    } else {\n      const passphrase = encodeURIComponent(cosmicLink.network)\n      const horizon = encodeURIComponent(cosmicLink.horizon)\n      query += `&network=custom&horizonURL=${horizon}`\n      query += `&networkPassphrase=${passphrase}`\n    }\n\n    return `${authenticator.url}${query}`\n  }\n}\n\nprotocols.copy = {\n  redirection: false,\n  textarea: true,\n  requestToXdr (cosmicLink) {\n    return cosmicLink.xdr\n  }\n}\n\nprotocols.testAccount = {\n  buttonText: \"Sign with Testnet Account\",\n  qrCode: false,\n  async getAddress () {\n    if (!this.keypair) return\n    const pubkey = this.keypair.publicKey()\n    if (await testnet.resolve.isAccountEmpty(pubkey)) {\n      await friendbot(pubkey).catch(() => null)\n    }\n    return pubkey\n  },\n  signRequest (cosmicLink) {\n    cosmicLink.sign(this.keypair)\n  }\n}\n\n/* Module loading */\n\nfunction getLedgerModule () {\n  return import(\n    /* webpackChunkName: \"ledger\" */ \"@cosmic-plus/ledger-wallet\"\n  ).then((ledger) => ledger.default)\n}\n\nfunction getTrezorModule () {\n  return import(\n    /* webpackChunkName: \"trezor\" */ \"@cosmic-plus/trezor-wallet\"\n  ).then((trezor) => {\n    trezor.register(\"https://cosmic.link\", \"mister.ticot@cosmic.plus\")\n    return trezor.default\n  })\n}\n","\"use strict\"\n/**\n * Wallets & signing methods that accept arbitrary transactions as input.\n */\nconst wallets = exports\n\n/* Data */\n\nwallets.Keybase = {\n  name: \"Keybase\",\n  protocol: \"sep0007\",\n  url: \"web+stellar:\",\n  federation: \"keybase.io\",\n  target: \"external\",\n  needSource: true,\n  needNetwork: \"public\"\n}\n\nwallets.LedgerWallet = {\n  name: \"Ledger Wallet\",\n  protocol: \"ledgerwallet\",\n  needSource: true,\n  needNetwork: true\n}\n\nwallets.TrezorWallet = {\n  name: \"Trezor Wallet\",\n  protocol: \"trezorwallet\",\n  needSource: true,\n  needNetwork: true\n}\n\nwallets.StellarAuthenticator = {\n  name: \"Stellar Authenticator\",\n  protocol: \"cosmiclink\",\n  url: \"https://stellar-authenticator.org/\"\n}\n\nwallets.Lobstr = {\n  name: \"Lobstr Web (partial support)\",\n  protocol: \"sep0007\",\n  url: \"https://lobstr.co/?tx=\",\n  target: \"new\",\n  needNetwork: \"public\"\n}\n\nwallets.StellarTerm = {\n  name: \"StellarTerm (partial support)\",\n  protocol: \"sep0007\",\n  url: \"https://stellarterm.com/?tx=\",\n  target: \"new\",\n  needNetwork: \"public\"\n}\n\nwallets.Sep7Wallet = {\n  name: \"Sep-0007 Wallet\",\n  protocol: \"sep0007\",\n  url: \"web+stellar:\",\n  target: \"external\",\n  needSource: true,\n  needNetwork: true\n}\n\nwallets.StellarLaboratory = {\n  name: \"Stellar Laboratory (Sign)\",\n  protocol: \"stellarlab\",\n  url: \"https://stellar.org/laboratory/#txsigner?xdr=\",\n  target: \"new\",\n  needSource: true,\n  needNetwork: true\n}\n\nwallets.StellarLaboratoryView = {\n  name: \"Stellar Laboratory (View)\",\n  protocol: \"stellarlab\",\n  url:\n    \"https://stellar.org/laboratory/#xdr-viewer?type=TransactionEnvelope&input=\",\n  target: \"new\",\n  needSource: true,\n  needNetwork: true\n}\n\nwallets.TestAccount = {\n  name: \"Test Account\",\n  protocol: \"testAccount\",\n  needSource: true,\n  needNetwork: \"test\"\n}\n\nwallets.CopyPasteXdr = {\n  name: \"Copy/Paste XDR\",\n  protocol: \"copy\",\n  needSource: true,\n  needNetwork: true\n}\n","\"use strict\"\n/**\n * Tx Description\n * */\n\nconst { View, html } = require(\"@kisbox/browser\")\nconst { type } = require(\"@kisbox/utils\")\n\nconst format = require(\"cosmic-lib/es5/format\")\n\n/* Definition */\n\nclass TxDescription extends View {\n  constructor (params) {\n    super(`\n<div class=\"TxDescription cosmiclink_description\">\n  %description\n  %status\n  %signers\n</div>\n    `)\n\n    this.$import(params, [\"cosmicLink\", \"result\", \"resolved\"])\n  }\n}\n\n/* Computations */\nconst proto = TxDescription.prototype\n\nproto.$define(\"description\", [\"cosmicLink\"], function () {\n  if (this.cosmicLink && this.cosmicLink.tdesc.operations) {\n    return this.cosmicLink.htmlDescription\n  } else {\n    return \"No transaction\"\n  }\n})\n\nproto.$customDefine(\"status\", [\"resolved\"], function () {\n  if (!this.cosmicLink || this.cosmicLink.status) return\n  if (!(this.resolved instanceof Error)) return\n\n  const cosmicLink = this.resolved.cosmicLink\n  if (!cosmicLink) return\n\n  const descriptionDiv = cosmicLink.htmlDescription\n  const statusDiv = html.grab(\".cosmiclib_statusNode\", descriptionDiv)\n  return statusDiv\n})\n\nproto.$customDefine(\"signers\", [\"resolved\"], function () {\n  if (!this.resolved || !type(this.resolved) === \"object\") return\n\n  const context = this.resolved\n  const transaction = this.resolved.transaction\n  if (!transaction) return this.signers\n\n  const signersNode = format.signatures(context, transaction)\n  return signersNode\n})\n\n/* Export */\nmodule.exports = TxDescription\n","\"use strict\"\n/**\n * Handler Form\n *\n * *Inputs:* authenticators, signingFlow*\n *\n * *: Can be edited by user input.\n **/\nconst { View } = require(\"@kisbox/browser\")\n\nconst AccountInput = require(\"./account-input\")\nconst HandlerSelector = require(\"./handler-selector\")\nconst NetworkSelector = require(\"./network-selector\")\n\n/* Definition */\n\nclass HandlerForm extends View {\n  constructor (signingFlow) {\n    super(`\n<form class=\"HandlerForm\" onsubmit=\"return false\">\n  %handlerSelector\n  <div hidden=%not:needSource>%accountInput</div>\n  <div hidden=%not:needNetwork>%networkSelector</div>\n</form>\n    `)\n\n    // Inputs\n    this.$import(signingFlow, [\"needSource\", \"needNetwork\"])\n\n    // Components\n    this.handlerSelector = new HandlerSelector(signingFlow)\n    this.accountInput = new AccountInput(signingFlow)\n    this.networkSelector = new NetworkSelector(signingFlow)\n  }\n}\n\n/* Export */\nmodule.exports = HandlerForm\n","\"use strict\"\n/**\n * Account Input Box\n * */\n\nconst { View } = require(\"@kisbox/browser\")\nconst { type } = require(\"@kisbox/utils\")\n\nconst { copyContent } = require(\"@kisbox/helpers\")\n\n/* Definition */\n\nclass AccountInput extends View {\n  constructor (params) {\n    super(`\n<div class=\"AccountInput\">\n  <input type=\"text\" value=%user autocomplete=\"stellar-user\"\n    placeholder=\"Username\"\n    hidden=%not:federation>\n  <input type=\"text\" value=%filter:accountId %onclick %readonly %placeholder\n    disabled=%notAvailable:accountId autocomplete=\"stellar-address\"\n    $ref=\"accountIdInput\" hidden=%federation>\n</div>\n      `)\n\n    /* Defaults */\n    this.accountId = \"\"\n\n    /* Imports */\n    this.$import(params, [\"cosmicLink\", \"authenticator\"])\n    this.$link(params, [\"accountId\"])\n  }\n\n  onclick () {\n    if (this.readonly) {\n      copyContent(this.$ref.accountIdInput)\n    }\n  }\n}\n\n/* Computations */\nconst proto = AccountInput.prototype\n\nproto.$on([\"user\", \"federation\"], function () {\n  if (!this.federation) return\n  this.accountId = this.user ? `${this.user}*${this.federation}` : null\n})\n\nproto.$on([\"federation\", \"accountId\"], function () {\n  if (!this.federation || !this.accountId) {\n    this.user = null\n    return\n  }\n\n  const federationPattern = `\\\\*${this.federation}$`\n  const federationRegexp = new RegExp(federationPattern)\n\n  if (this.accountId.match(federationRegexp)) {\n    this.user = this.accountId.replace(federationRegexp, \"\")\n  } else {\n    this.accountId = null\n    this.user = null\n  }\n})\n\nproto.$define(\"federation\", [\"authenticator\"], function () {\n  return this.authenticator.federation\n})\n\nproto.$define(\"readonly\", [\"cosmicLink\", \"authenticator\"], function () {\n  return !!(\n    this.cosmicLink && this.cosmicLink.tdesc.source\n    || this.authenticator.getAddress\n  )\n})\n\nproto.$customDefine(\"placeholder\", [\"accountId\"], function () {\n  switch (type(this.accountId)) {\n  case \"promise\":\n    return \"Connecting...\"\n  case \"error\":\n    return this.accountId\n  default:\n    return \"Federated Address or Public Key\"\n  }\n})\n\n/* Helpers */\nconst helpers = AccountInput.helpers\n\nhelpers.filter = function (accountId) {\n  if (type(accountId) === \"string\") {\n    return accountId\n  }\n}\n\n/* Export */\nmodule.exports = AccountInput\n","\"use strict\"\n/**\n * Handler Selector\n *\n * * Import: authenticators\n * * Link: authenticatorId\n *\n * */\nconst { View, html } = require(\"@kisbox/browser\")\n\n/* Definition */\n\nclass HandlerSelector extends View {\n  constructor (params) {\n    super(`\n<select class=\"HandlerSelector\" value=%authenticatorId>\n  %toOption:...filteredHandlers\n</select>\n    `)\n\n    this.$import(params, [\"authenticators\", \"cosmicLink\", \"resolved\"])\n    this.$link(params, [\"authenticatorId\"])\n  }\n\n  isTxHandlerValid (txHandlerId) {\n    return this.filteredHandlers.some((txHandler) => {\n      return txHandler.id === txHandlerId\n    })\n  }\n}\n\n/* Computations */\nconst proto = HandlerSelector.prototype\n\nproto.$define(\n  \"filteredHandlers\",\n  [\"authenticators\", \"cosmicLink\"],\n  function () {\n    const network = this.cosmicLink && this.cosmicLink.tdesc.network\n    if (!network) return this.authenticators\n    if (this.resolved) return this.filteredHandlers\n\n    return this.authenticators.filter((handler) => {\n      const wantNetwork = handler.needNetwork\n      return typeof wantNetwork !== \"string\" || wantNetwork === network\n    })\n  }\n)\n\n// Make sure selected handler is a valid option for this network.\nproto.$on(\"authenticatorId\", function (authenticatorId) {\n  if (!authenticatorId) return\n  if (this.isTxHandlerValid(this.authenticatorId)) return\n\n  switch (this.cosmicLink.network) {\n  case \"public\":\n  case null:\n    this.authenticatorId = \"Keybase\"\n    break\n  case \"test\":\n    this.authenticatorId = \"TestAccount\"\n    break\n  default:\n    this.authenticatorId = \"StellarLaboratory\"\n  }\n})\n\n/* Helpers */\nconst helpers = HandlerSelector.helpers\n\nhelpers.toOption = function (handler) {\n  return html(\"option\", { value: handler.id }, handler.name)\n}\n\n/* Export */\nmodule.exports = HandlerSelector\n","\"use strict\"\n/**\n * Network Selector\n * */\nconst { View } = require(\"@kisbox/browser\")\n\n/* Definition */\n\nclass NetworkSelector extends View {\n  constructor (params) {\n    super(`\n<div class=\"NetworkSelector\">\n\n  <div>\n    <input type=\"radio\" $group=\"networkSelector\" value=\"public\"\n      disabled=%lockNetwork $label=\"Public\">\n    <input type=\"radio\" $group=\"networkSelector\" value=\"test\"\n      disabled=%lockNetwork $label=\"Test\">\n    <input type=\"radio\" $group=\"networkSelector\" value=\"custom\"\n      disabled=%lockNetwork $label=\"Custom\">\n  </div>\n\n  <div hidden=%not:isCustom>\n    <input type=\"text\" value=%network disabled=%lockNetwork\n      placeholder=\"Network Passphrase or Name\">\n    <input type=\"text\" value=%horizon\n      placeholder=\"Horizon URL\">\n  </div>\n  \n</div>\n    `)\n\n    this.$import(params, [\"lockNetwork\"])\n    this.$link(params, [\"network\", \"horizon\"])\n  }\n}\n\n/* Computations */\nconst proto = NetworkSelector.prototype\n\nproto.$define(\"networkSelector\", [\"network\"], function () {\n  if (this.network === \"public\" || this.network === \"test\") {\n    return this.network\n  } else {\n    return \"custom\"\n  }\n})\n\nproto.$define(\"isCustom\", [\"networkSelector\"], function () {\n  return this.networkSelector === \"custom\"\n})\n\n/* Events */\nproto.$on(\"networkSelector\", function () {\n  if (!this.isCustom) {\n    this.network = this.networkSelector\n  }\n})\n\n/* Export */\nmodule.exports = NetworkSelector\n","\"use strict\"\n/**\n * Redirection Form\n * */\nconst { View, html } = require(\"@kisbox/browser\")\nconst { type } = require(\"@kisbox/utils\")\nconst { timeout } = require(\"@kisbox/helpers\")\n\nconst QrCodeSwitcher = require(\"./qr-code-switcher\")\nconst RedirectionButton = require(\"./redirection-button\")\nconst TxResultView = require(\"./tx-result-view\")\nconst XdrArea = require(\"./xdr-area\")\n\n/* Definition */\n\nclass RedirectionForm extends View {\n  constructor (signingFlow) {\n    super(`\n<form class=\"RedirectionForm\" hidden=%not:showButton>\n  %redirectionButton\n  <div $ref=\"messageBox\"></div>\n  %txResultView\n</form>\n\n\n<form hidden=%not:showTextarea>\n  %xdrArea\n</form>\n\n<div hidden=%not:showQrCodeSwitcher>\n  %qrCodeSwitcher\n</div>\n    `)\n\n    this.$import(signingFlow, [\"cosmicLink\", \"authenticator\", \"result\"])\n\n    // Components\n    this.redirectionButton = new RedirectionButton(signingFlow)\n    this.xdrArea = new XdrArea(signingFlow)\n    this.qrCodeSwitcher = new QrCodeSwitcher(signingFlow)\n  }\n}\n\n/* Computations */\nconst proto = RedirectionForm.prototype\n\nproto.$define(\"showButton\", [\"authenticator\"], function () {\n  return this.authenticator.requestToUri || this.authenticator.signRequest\n})\n\nproto.$define(\"showTextarea\", [\"authenticator\"], function () {\n  return this.authenticator.requestToXdr\n})\n\nproto.$define(\n  \"showQrCodeSwitcher\",\n  [\"cosmicLink\", \"authenticator\"],\n  function () {\n    return (\n      this.cosmicLink\n      && (this.authenticator.requestToUri || this.authenticator.requestToXdr)\n    )\n  }\n)\n\nproto.$customDefine(\"txResultView\", [\"result\"], function () {\n  if (type(this.result) === \"error\") {\n    return html(\"span\", { className: \"error\" }, this.result.message)\n  } else {\n    return new TxResultView(this.result)\n  }\n})\n\nproto.$on(\"txResultView\", function () {\n  if (!this.result) return\n  timeout(0).then(() => window.scrollTo(0, window.innerHeight))\n})\n\n/* Export */\nmodule.exports = RedirectionForm\n","\"use strict\"\n/**\n * QR Code UI\n */\nconst { View } = require(\"@kisbox/browser\")\nconst { type } = require(\"@kisbox/utils\")\n\nconst QrCodeCanvas = require(\"./qr-code-canvas\")\n\n/* Definition */\n\nclass QrCodeSwitcher extends View {\n  constructor (params) {\n    super(`\n<form id=\"qrForm\">\n  <input type=\"button\" value=\"QR Code\" onclick=%switch %disabled>\n  <div %hidden>%canvas</div>\n</form>\n  `)\n\n    this.$import(params, [\"uri\", \"xdr\"])\n    this.$link(params, [\"showQrCode\"])\n\n    this.canvas = new QrCodeCanvas(this)\n  }\n\n  switch () {\n    this.showQrCode = !this.showQrCode\n  }\n}\n\n/* Computations */\nconst proto = QrCodeSwitcher.prototype\n\nproto.$define(\"target\", [\"uri\", \"xdr\"], function () {\n  return this.uri || this.xdr\n})\n\nproto.$customDefine(\"disabled\", [\"target\"], function () {\n  return type(this.target) === \"error\"\n})\n\nproto.$define(\"hidden\", [\"showQrCode\", \"disabled\"], function () {\n  return !this.showQrCode || this.disabled\n})\n\n/* Exports */\nmodule.exports = QrCodeSwitcher\n","\"use strict\"\n/**\n * QR Code Canvas\n */\nconst QrCode = require(\"qrcode\")\n\nconst { View } = require(\"@kisbox/browser\")\nconst { type } = require(\"@kisbox/utils\")\nconst { timeout } = require(\"@kisbox/helpers\")\n\n/* Definition */\n\nclass QrCodeCanvas extends View {\n  constructor (params) {\n    super(`\n<div class=\"QrCodeCanvas\">\n  <span class=\"cosmiclib_loadingAnim\" hidden=%notPending:target></span>\n  <canvas $ref=\"canvas\" title=%target hidden=%not:target></canvas>\n</div>\n`)\n\n    this.$import(params, [\"target\"])\n  }\n}\n\n/* Computations */\nconst proto = QrCodeCanvas.prototype\n\nproto.$on(\"target\", function () {\n  if (type(this.target) === \"string\") {\n    setQr(this.$ref.canvas, this.target)\n  } else if (this.$ref.canvas) {\n    clearQr(this.$ref.canvas)\n  }\n})\n\n/* Helpers */\n\nfunction setQr (canvas, target) {\n  // Make heavy computation async.\n  timeout(1).then(() => {\n    const scale = Math.max(3, 6 - Math.floor(Math.sqrt(target) / 10))\n    QrCode.toCanvas(canvas, target, { margin: 0, scale })\n  })\n}\n\nfunction clearQr (canvas) {\n  const context = canvas.getContext(\"2d\")\n  context.clearRect(0, 0, canvas.width, canvas.height)\n}\n\n/* Exports */\nmodule.exports = QrCodeCanvas\n","\"use strict\"\n/**\n * Redirection Button\n * */\nconst { View } = require(\"@kisbox/browser\")\nconst { type } = require(\"@kisbox/utils\")\n\n/* Definition */\n\nclass RedirectionButton extends View {\n  constructor (params) {\n    super(`\n<div class=\"RedirectionButton\">\n  <input type=\"button\" hidden=%not:cosmicLink value=%buttonText\n    onclick=%linkAction disabled=%disabled>\n  <input type=\"button\" hidden=%has:cosmicLink value=%noLinkButtonText\n    onclick=%noLinkAction disabled=%noLinkDisabled>\n  <input type=\"checkbox\" checked=%automaticRedirection\n    $label=\"Automatic redirection\">\n</div>\n    `)\n\n    this.$import(params, [\n      \"authenticator\",\n      \"resolved\",\n      \"action\",\n      \"result\",\n      \"cosmicLink\"\n    ])\n    this.$link(params, [\"automaticRedirection\"])\n  }\n\n  linkAction () {\n    this.action()\n    if (this.authenticator.signRequest) {\n      window.scrollTo(0, window.innerHeight)\n    }\n  }\n\n  noLinkAction () {\n    open(this.authenticator.url)\n  }\n}\n\n/* Computations */\nconst proto = RedirectionButton.prototype\n\nproto.$define(\"noLinkButtonText\", [\"authenticator\"], function () {\n  if (this.authenticator.url) {\n    const shortName = this.authenticator.name.replace(/ \\(.*/, \"\")\n    return `Go to ${shortName}`\n  } else {\n    return \"No transaction\"\n  }\n})\n\nproto.$define(\"noLinkDisabled\", [\"authenticator\"], function () {\n  return !this.authenticator.url\n})\n\nproto.$customDefine(\n  \"buttonText\",\n  [\"authenticator\", \"resolved\", \"result\"],\n  function () {\n    if (type(this.signed) === \"promise\") {\n      return \"Signing...\"\n    } else if (type(this.result) === \"promise\") {\n      return \"Sending...\"\n    } else if (this.result) {\n      return \"Done\"\n    } else if (type(this.resolved) === \"error\") {\n      return this.resolved\n    } else if (type(this.resolved) === \"promise\") {\n      return \"...\"\n    } else {\n      return `Sign with ${this.authenticator.name}`\n    }\n  }\n)\n\nproto.$customDefine(\"disabled\", [\"action\", \"result\"], function () {\n  return (\n    !this.action\n    || type(this.action) === \"promise\"\n    || type(this.action) === \"error\"\n    || this.result\n  )\n})\n\n/* Export */\nmodule.exports = RedirectionButton\n","\"use strict\"\n/**\n * TxResultView - Displays TxResult instances\n */\nconst TxResult = require(\"@cosmic-plus/tx-result\")\nconst { View, html } = require(\"@kisbox/browser\")\n\n/* Definition */\n\nclass TxResultView extends View {\n  static async forCosmicLink (cosmicLink) {\n    const result = await TxResult.forCosmicLink(cosmicLink)\n    return new TxResultView(result)\n  }\n\n  static fromResponse (response) {\n    const result = new TxResult(response)\n    return new TxResultView(result)\n  }\n\n  constructor (txResult) {\n    super(`\n<div class=\"TxResultView cosmiclink_description\">\n\n  <span class=%state>%title</span>\n\n  <ul class=\"error\" hidden=%validated>\n    %{toLi:...errors}\n  </ul>\n\n</div>\n    `)\n\n    this.$import(txResult, [\"title\", \"errors\", \"validated\"])\n    this.state = this.validated ? \"info\" : \"error\"\n  }\n}\n\n/* Helpers */\nTxResultView.helpers.toLi = (any) => html(\"li\", [any])\n\n/* Exports */\nmodule.exports = TxResultView\n","\"use strict\"\n/**\n * XdrArea\n **/\nconst { View } = require(\"@kisbox/browser\")\nconst { type } = require(\"@kisbox/utils\")\nconst { copyContent } = require(\"@kisbox/helpers\")\n\n/* Definition */\n\nclass XdrArea extends View {\n  constructor (params) {\n    super(`\n<textarea rows=3 readonly %value %onclick %placeholder disabled=%not:xdr>\n</textarea>\n    `)\n\n    this.$import(params, [\"cosmicLink\", \"xdr\"])\n  }\n\n  onclick () {\n    copyContent(this.domNode)\n  }\n}\n\n/* Computations */\nconst proto = XdrArea.prototype\n\nproto.$customDefine(\"placeholder\", [\"cosmicLink\", \"xdr\"], function () {\n  if (!this.cosmicLink) {\n    return \"No transaction\"\n  } else if (type(this.xdr) === \"promise\") {\n    return \"Pending...\"\n  }\n})\n\nproto.$customDefine(\"value\", [\"xdr\"], function () {\n  if (type(this.xdr) === \"string\" || type(this.xdr) === \"error\") {\n    return this.xdr\n  }\n})\n\n/* Export */\nmodule.exports = XdrArea\n","\"use strict\"\n/**\n * App Full\n *\n * inouts: query, selectedTabId, antiTamperHash, signingFlow\n * outputs: route\n *\n * */\nconst { sep7Utils } = require(\"cosmic-lib\")\nconst { View, html } = require(\"@kisbox/browser\")\n\nconst AppState = require(\"./app.state\")\nconst Navigation = require(\"./lib/navigation\")\n\nconst AntiTamper = require(\"./view/anti-tamper\")\nconst SigningWidget = require(\"./view/signing-widget\")\n\nconst { copyContent } = require(\"@kisbox/helpers\")\n\n/* Definition */\n\nclass AppFull extends View {\n  constructor (params) {\n    super(`\n<div class=\"CosmicLinkApp\">\n  <header onclick=%copyHeader>\n    <h1>%location</h1><span>%query</span>\n  </header>\n\n  <img id=\"logo\" src=\"icons/512x512.png\" alt=\"\">\n\n  <main>\n    %navigation\n    <hr>\n    %selectedTabView\n  </main>\n\n  <footer>\n    <a id=\"registerSep7Handler\" onclick=%registerSep7Handler\n        hidden=%not:isSep7Supported>\n      Register as web+stellar links handler (SEP-0007)\n    </a>\n  </footer>\n\n  %antiTamper\n</div>\n`)\n    this.selectedTabId = \"sign\"\n    this.state = new AppState(params)\n    this.$import(this.state, [\"query\"])\n    this.$import(params, [\"selectedTabId\"])\n\n    // Header\n    if (location.origin === \"null\") {\n      this.location = location.pathname\n    } else {\n      this.location = `${location.origin}${location.pathname}`\n    }\n\n    // Navigation\n    this.navigation = new Navigation([\n      {\n        id: \"sign\",\n        title: \"Sign\",\n        view: new SigningWidget(this.state)\n      },\n      {\n        id: \"about\",\n        title: \"About\",\n        view: html.grab(\"#about\")\n      }\n    ])\n\n    this.navigation.$link(this, [\"selectedTabView\", \"selectedTabId\"])\n    if (!this.selectedTabView) {\n      this.selectedTabId = \"sign\"\n    }\n\n    // SEP-0007\n    this.isSep7Supported = sep7Utils.isWebHandlerSupported()\n\n    // Robot anti-tamper\n    this.antiTamper = new AntiTamper(params)\n  }\n\n  copyHeader () {\n    copyContent(this.$ref(\":scope > header\"))\n  }\n\n  registerSep7Handler () {\n    const currentPageUrl = location.href.split(/[?#]/, 1)[0]\n    sep7Utils.registerWebHandler(currentPageUrl, \"Cosmic.link\")\n  }\n}\n\n/* Computations */\nconst proto = AppFull.prototype\n\nproto.$define(\"route\", [\"query\", \"selectedTabId\"], function () {\n  const tab = this.selectedTabId\n  const query = tab === \"sign\" ? this.query || \"\" : \"\"\n  const hash = tab === \"sign\" ? \"\" : `#${this.selectedTabId}`\n  return `${query}${hash}`\n})\n\n/* Export */\nmodule.exports = AppFull\n","\"use strict\"\n/**\n * Navigation\n * */\nconst { View, html } = require(\"@kisbox/browser\")\nconst { LiveArray } = require(\"@kisbox/model\")\n\n/* Definition */\n\nclass Navigation extends View {\n  constructor (tabs = []) {\n    super(`\n<nav>%toNavigationLink:...tabs</nav>\n    `)\n\n    this.tabs = LiveArray.from(tabs)\n  }\n}\n\n/* Helpers */\nconst helpers = Navigation.helpers\n\nhelpers.toNavigationLink = function (tab) {\n  const link = html(\"a\", null, tab.title)\n  link.onclick = () => this.selectedTabId = tab.id\n  this.$on(\"selectedTabId\", (selectedTabId) => {\n    link.className = selectedTabId === tab.id ? \"selected\" : \"\"\n  })\n  return link\n}\n\n/* Computations */\nconst proto = Navigation.prototype\n\nproto.$define(\"selectedTabView\", [\"selectedTabId\"], function () {\n  const tab = this.tabs.find((t) => t.id === this.selectedTabId)\n  if (tab) return tab.view\n})\n\n/* Export */\nmodule.exports = Navigation\n","\"use strict\"\n/**\n * Anti-tamper robot.\n */\nconst { View } = require(\"@kisbox/browser\")\n\n/* Definition */\n\nclass AntiTamper extends View {\n  constructor (params = {}) {\n    super(`<img class=\"AntiTamper\" %src>`)\n    this.$import(params, [\"baseUrl\", \"set\", \"antiTamperHash\"])\n  }\n}\n\n/* Defaults */\nconst proto = AntiTamper.prototype\nproto.baseUrl = \"https://robohash.org\"\nproto.set = \"set1\"\n\n/* Computations */\n\nproto.$define(\"src\", [\"baseUrl\", \"set\", \"antiTamperHash\"], function () {\n  return `${this.baseUrl}/${this.antiTamperHash}?set=${this.set}`\n})\n\n/* Utilities */\n\nAntiTamper.makeHash = function (size = 32) {\n  const alphabet =\n    \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n\n  let hash = \"\"\n  for (let i = 0; i < size; i++) {\n    const random = Math.floor(Math.random() * alphabet.length)\n    hash += alphabet.charAt(random)\n  }\n\n  return hash\n}\n\n/* Export */\nmodule.exports = AntiTamper\n"],"sourceRoot":""}