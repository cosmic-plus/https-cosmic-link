{"version":3,"sources":["webpack:///./src/app.js","webpack:///./src/helpers.js","webpack:///./src/tamper.js","webpack:///./src/signing-ui.js"],"names":["dom","require","Page","copyContent","location","origin","websiteUrl","textContent","pathname","query","search","header","onclick","signingUI","signingPage","add","sign","onSelect","history","replaceState","refresh","init","help","current","select","helpers","exports","html","enableButton","button","value","disabled","disableButton","readWriteBox","box","placeholder","readOnly","undefined","style","cursor","readOnlyBox","disableBox","display","element","type","message","classname","messageNode","create","rewrite","showIf","flag","show","hide","switchPage","from","to","append","body","main","document","activeElement","prevNode","grab","destroy","copiedNode","parentNode","insertBefore","setTimeout","hidden","tamper","src","localStorage","myHash","alphabet","hash","i","charAt","Math","floor","random","length","cosmicLib","CosmicLink","env","QrCode","timeout","authenticators","the","key","cosmiclink_description","nodes","forEach","entry","authenticator","name","redirect","redirectionCheckbox","checked","qrCode","qrCodeUI","enable","substr","id","passphrase","resolve","networkPassphrase","config","setupNetwork","cosmicLink","tdesc","authenticatorUI","redirectionUI","transactionUI","needSource","accountId","needNetwork","customNetwork","horizon","network","source","saveTransaction","transaction","handle","then","error","status","getAccountId","accountMsgbox","accountUI","disable","networkUI","accountDiv","accountIdBox","networkDiv","customNetworkSetup","networkSelector","publicNetwork","scrollLeft","testNetwork","onscroll","customPassphrase","customHorizon","lock","selector","onchange","onExit","textOverflow","networkName","redirection","redirectionForm","textarea","textareaForm","qrForm","redirectionButton","xdrBox","loadingAnim","url","buttonText","href","click","clear","isEmbedded","target","open","window","parent","postMessage","replace","redirectionMsgbox","sendTransaction","console","response","send","referrer","back","canvas","toCanvas","margin","scale","title","QR","qrButton","className"],"mappings":"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","file":"app.js","sourcesContent":["\"use_strict\"\n/**\n * Cosmic.Link Graphical User Interface\n */\nconst dom = require(\"@cosmic-plus/domutils/es5/dom\")\nconst Page = require(\"@cosmic-plus/domutils/es5/page\")\n\nconst { copyContent } = require(\"./helpers\")\n\n// Header\nif (location.origin === \"null\") dom.websiteUrl.textContent = location.pathname\nelse dom.websiteUrl.textContent = location.origin + location.pathname\ndom.query.textContent = location.search\ndom.header.onclick = () => copyContent(dom.header)\n\n// Robot tamper\nrequire(\"./tamper\")\n\n// Signing interface\nconst signingUI = require(\"./signing-ui\")\nconst signingPage = Page.add(\"Sign\", dom.sign)\nsigningPage.onSelect = function () {\n  history.replaceState(\"\", null, location.pathname + location.search)\n  signingUI.refresh()\n}\n\nsigningUI.init()\n\n// About page\nPage.add(\"Help\", dom.help)\n\n// Default page\nif (Page.current === signingPage) signingPage.onSelect()\nelse if (!Page.current) Page.select(\"#sign\")\n","\"use_strict\"\n/**\n * Generic helpers\n */\nconst helpers = exports\n\nconst dom = require(\"@cosmic-plus/domutils/es5/dom\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\n\n/*******************************************************************************\n * Form Elements Helpers\n */\n\nhelpers.enableButton = function (button, value, onclick) {\n  if (typeof value === \"string\") button.value = value\n  button.onclick = onclick\n  button.disabled = false\n}\n\nhelpers.disableButton = function (button, value) {\n  if (typeof value === \"string\") button.value = value\n  button.disabled = true\n}\n\nhelpers.readWriteBox = function (box, placeholder, value) {\n  if (typeof value === \"string\") box.value = value\n  if (typeof placeholder === \"string\") box.placeholder = placeholder\n  box.disabled = false\n  box.readOnly = false\n  box.onclick = undefined\n  box.style.cursor = \"initial\"\n}\n\nhelpers.readOnlyBox = function (box, value) {\n  if (typeof value === \"string\") box.value = value\n  box.disabled = false\n  box.readOnly = true\n  box.onclick = () => helpers.copyContent(box)\n  box.style.cursor = \"pointer\"\n}\n\nhelpers.disableBox = function (box, placeholder) {\n  helpers.readWriteBox(box, placeholder, \"\")\n  box.disabled = true\n}\n\n/*******************************************************************************\n * Other Helpers\n */\n\nhelpers.display = function (element, type = \"\", message = \"\") {\n  const classname = type ? \".\" + type : null\n  const messageNode = classname\n    ? html.create(\"span\", classname, message)\n    : message\n  html.rewrite(element, html.create(\"span\", classname, messageNode))\n}\n\nhelpers.showIf = function (flag, element) {\n  flag ? html.show(element) : html.hide(element)\n}\n\nhelpers.switchPage = function (from, to) {\n  html.append(dom.body, from)\n  html.append(dom.main, to)\n}\n\nhelpers.copyContent = function (element) {\n  if (html.copyContent(element) && document.activeElement.value) {\n    const prevNode = html.grab(\"#copied\")\n    if (prevNode) html.destroy(prevNode)\n    const copiedNode = html.create(\"span\", \"#copied\", \"Copied\")\n    element.parentNode.insertBefore(copiedNode, element)\n    setTimeout(() => {\n      copiedNode.hidden = true\n    }, 3000)\n  }\n}\n","\"use_strict\"\n/**\n * Robot tamper.\n */\nconst dom = require(\"@cosmic-plus/domutils/es5/dom\")\n\nfunction myHash () {\n  if (localStorage.myHash) return localStorage.myHash\n\n  var alphabet =\n    \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n  var size = 32\n\n  var hash = \"\"\n  for (var i = 0; i < size; i++) {\n    hash += alphabet.charAt(Math.floor(Math.random() * alphabet.length))\n  }\n\n  localStorage.myHash = hash\n  return hash\n}\n\ndom.tamper.src = \"https://robohash.org/\" + myHash()\n","\"use_strict\"\nconst main = exports\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst CosmicLink = cosmicLib.CosmicLink\nconst dom = require(\"@cosmic-plus/domutils/es5/dom\")\nconst env = require(\"@cosmic-plus/jsutils/es5/env\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst QrCode = require(\"qrcode\")\nconst { timeout } = require(\"@cosmic-plus/jsutils/es5/misc\")\n\nconst authenticators = require(\"./authenticators\")\nconst the = require(\"./shared\")\n\nconst {\n  enableButton,\n  disableButton,\n  readWriteBox,\n  readOnlyBox,\n  disableBox,\n  display,\n  showIf\n} = require(\"./helpers\")\n\n// Run once page is fully loaded\nmain.init = function () {\n  // Step 1: Transaction\n  if (!the.query) html.rewrite(dom.cosmiclink_description, \"No transaction\")\n\n  // Step 2: Authenticator\n  authenticators.nodes.forEach(entry => html.append(dom.authenticators, entry))\n  dom.authenticators.value = the.authenticator.name\n\n  // Step 3: Signing\n  if (the.redirect) dom.redirectionCheckbox.checked = true\n  if (the.qrCode) qrCodeUI.enable()\n\n  // CosmicLib network setup\n  for (let key in localStorage) {\n    if (key.substr(0, 8) === \"network:\") {\n      const id = key.substr(8)\n      const passphrase = cosmicLib.resolve.networkPassphrase(id)\n      cosmicLib.config.setupNetwork(id, localStorage[key], passphrase)\n    }\n  }\n}\n\nmain.refresh = async function () {\n  if (the.query) the.cosmicLink = new CosmicLink(the.query)\n  else the.cosmicLink = { tdesc: {} }\n  authenticatorUI.init()\n  redirectionUI.init()\n  if (the.cosmicLink.query) transactionUI.refresh()\n}\n\n/*******************************************************************************\n * Step 1: Transaction UI\n */\n\nconst transactionUI = {}\n\ntransactionUI.refresh = function () {\n  if (the.authenticator.needSource && !the.accountId) {\n    if (!the.authenticator.getAccountId) {\n      redirectionUI.error(\"Please set a source account\")\n    }\n    return\n  }\n  if (the.authenticator.needNetwork) {\n    if (dom.customNetwork.checked && (!the.horizon || !the.network)) {\n      redirectionUI.error(\"Please fill custom network fields\")\n      return\n    }\n  }\n\n  cosmicLib.config.source = the.accountId\n  cosmicLib.config.network = the.network\n\n  const saveTransaction = the.transaction = the.authenticator.handle(\n    the.cosmicLink\n  )\n\n  the.transaction\n    .then(function (value) {\n      if (the.transaction === saveTransaction) redirectionUI.refresh(value)\n    })\n    .catch(function () {\n      if (the.transaction === saveTransaction)\n        redirectionUI.error(the.cosmicLink.status)\n    })\n}\n\n/*******************************************************************************\n * Step 2: Authenticator UI\n */\n\nconst authenticatorUI = {}\n\nauthenticatorUI.init = function () {\n  display(dom.accountMsgbox, \"\")\n  the.authenticator = authenticators[dom.authenticators.value]\n  localStorage.authenticator = the.authenticator.name\n\n  if (the.authenticator.needSource) accountUI.init()\n  else accountUI.disable()\n  if (the.authenticator.needNetwork) networkUI.init()\n  else networkUI.disable()\n\n  if (the.authenticator.refresh) the.authenticator.refresh(main.refresh)\n}\n\n/**\n * AccountID box UI\n */\nconst accountUI = {}\n\naccountUI.disable = function () {\n  html.hide(dom.accountDiv)\n  the.accountId = undefined\n}\n\naccountUI.init = async function () {\n  html.show(dom.accountDiv)\n\n  if (!the.authenticator.getAccountId) {\n    if (the.cosmicLink.tdesc.source) {\n      if (the.cosmicLink.tdesc.source.error) {\n        disableBox(dom.accountIdBox, the.cosmicLink.tdesc.source.error.message)\n      } else {\n        the.accountId = true\n        readOnlyBox(dom.accountIdBox, the.cosmicLink.tdesc.source)\n      }\n    } else {\n      the.accountId = localStorage.accountId\n      readWriteBox(\n        dom.accountIdBox,\n        \"Your Account Address or ID\",\n        the.accountId\n      )\n    }\n  } else {\n    the.accountId = undefined\n    disableBox(dom.accountIdBox, \"Connecting...\")\n\n    const authenticator = the.authenticator\n    try {\n      const accountId = await the.authenticator.getAccountId()\n      if (the.authenticator !== authenticator) return\n      the.accountId = accountId\n      readOnlyBox(dom.accountIdBox, accountId)\n      transactionUI.refresh()\n    } catch (error) {\n      if (the.authenticator !== authenticator) return\n      dom.accountIdBox.placeholder = \"Error\"\n      display(dom.accountMsgbox, \"error\", error.message + \".\")\n    }\n  }\n}\n\n/**\n * Network selection UI\n */\nconst networkUI = {}\n\nnetworkUI.disable = function () {\n  html.hide(dom.networkDiv)\n  the.network = \"public\"\n  the.horizon = undefined\n}\n\nnetworkUI.init = function () {\n  html.show(dom.networkDiv)\n  html.hide(dom.customNetworkSetup)\n  the.network = the.cosmicLink.tdesc.network || localStorage.networkSelector\n  the.horizon = undefined\n\n  switch (the.network) {\n  case undefined:\n  case \"public\":\n    dom.publicNetwork.checked = true\n    dom.networkSelector.scrollLeft = 0\n    break\n  case \"test\":\n    dom.testNetwork.checked = true\n    break\n  default:\n    if (dom.networkSelector.onscroll) dom.networkSelector.onscroll()\n    // Doesn't works when called synchronously.\n    timeout(1).then(() => dom.networkSelector.scrollLeft = 999)\n    dom.customNetwork.checked = true\n\n    html.show(dom.customNetworkSetup)\n    if (!the.network) the.network = localStorage.customPassphrase\n    the.horizon =\n        cosmicLib.resolve.horizon(the.network || \"\")\n        || the.cosmicLink.tdesc.horizon\n    dom.customPassphrase.value = the.network || \"\"\n    dom.customHorizon.value = the.horizon || \"\"\n  }\n\n  if (the.cosmicLink.tdesc.network) networkUI.lock()\n}\n\nnetworkUI.lock = function () {\n  readOnlyBox(dom.customPassphrase)\n  dom.publicNetwork.disabled = true\n  dom.testNetwork.disabled = true\n  dom.customNetwork.disabled = true\n}\n\nnetworkUI.switch = function (selector) {\n  localStorage.networkSelector = selector\n  main.refresh()\n}\n\n/**\n * HTML Elements Events\n */\n\ndom.authenticators.onchange = function () {\n  if (the.authenticator && the.authenticator.onExit) the.authenticator.onExit()\n  the.redirect = localStorage.redirect = false\n  dom.redirectionCheckbox.checked = false\n  main.refresh()\n}\n\ndom.accountIdBox.onchange = function () {\n  the.accountId = localStorage.accountId = dom.accountIdBox.value\n  main.refresh()\n}\n\ndom.networkSelector.onscroll = function () {\n  dom.networkSelector.style.textOverflow = \"initial\"\n  dom.networkSelector.onscroll = undefined\n}\n\ndom.publicNetwork.onchange = () => networkUI.switch(\"public\")\ndom.testNetwork.onchange = () => networkUI.switch(\"test\")\ndom.customNetwork.onchange = () => networkUI.switch(\"\")\n\ndom.customPassphrase.onchange = function () {\n  const networkName = cosmicLib.resolve.networkName(dom.customPassphrase.value)\n  localStorage.customPassphrase = networkName\n  networkUI.switch(\"\")\n}\n\ndom.customHorizon.onchange = function () {\n  the.horizon = dom.customHorizon.value\n  if (the.horizon && the.horizon.substr(0, 4) !== \"http\") {\n    the.horizon = \"https://\" + the.horizon\n  }\n  if (the.network && the.horizon) {\n    const passphrase = cosmicLib.resolve.networkPassphrase(the.network)\n    cosmicLib.config.setupNetwork(the.network, the.horizon, passphrase)\n    localStorage[\"network:\" + passphrase] = the.horizon\n  }\n  if (the.network) main.refresh()\n}\n\n/*******************************************************************************\n * Step 3: Signing/Redirection UI\n */\n\nconst redirectionUI = {}\n\nredirectionUI.init = function () {\n  redirectionUI.display(\"\")\n  showIf(the.authenticator.redirection, dom.redirectionForm)\n  showIf(the.authenticator.textarea, dom.textareaForm)\n  showIf(the.query && the.authenticator.qrCode, dom.qrForm)\n\n  if (!the.query) {\n    if (the.authenticator.url) {\n      const onclick = () => location.href = the.authenticator.url\n      enableButton(dom.redirectionButton, the.authenticator.buttonText, onclick)\n    } else {\n      redirectionUI.error(\"No transaction\")\n    }\n  } else {\n    if (the.authenticator.redirection) disableButton(dom.redirectionButton, \"â€¦\")\n    if (the.authenticator.textarea) disableBox(dom.xdrBox, \"Computing...\")\n    if (the.authenticator.qrCode) qrCodeUI.loadingAnim()\n  }\n}\n\nredirectionUI.refresh = function (value) {\n  if (the.authenticator.redirection) {\n    const onclick = () => redirectionUI.click(value)\n    enableButton(dom.redirectionButton, the.authenticator.buttonText, onclick)\n  }\n\n  if (the.redirect) dom.redirectionButton.onclick()\n\n  if (the.authenticator.textarea) readOnlyBox(dom.xdrBox, value)\n  if (the.authenticator.qrCode) qrCodeUI.refresh(value)\n}\n\nredirectionUI.error = function (error) {\n  disableButton(dom.redirectionButton, error)\n  disableBox(dom.xdrBox, error)\n  html.clear(dom.qrCode)\n}\n\nredirectionUI.click = async function (value) {\n  if (typeof value === \"string\") {\n    if (env.isEmbedded && the.authenticator.target === \"new\") {\n      open(value, \"_blank\")\n      window.parent.postMessage(\"close\", \"*\")\n    } else if (env.isEmbedded && the.authenticator.target === \"external\") {\n      open(value)\n      window.parent.postMessage(\"close\", \"*\")\n    } else {\n      location.replace(value)\n    }\n  } else if (typeof value === \"function\") {\n    display(dom.redirectionMsgbox, \"info\", \"Waiting for confirmation...\")\n    dom.redirectionButton.disabled = true\n\n    try {\n      const transaction = await value()\n      await redirectionUI.sendTransaction(transaction)\n    } catch (error) {\n      console.error(error.response || error)\n      redirectionUI.display(\"error\", error.message.replace(/\\.$/, \"\"))\n      dom.redirectionButton.disabled = false\n    }\n  }\n}\n\nredirectionUI.sendTransaction = async function () {\n  redirectionUI.display(\"info\", \"Sending to the network...\")\n  history.replaceState({}, \"\", the.cosmicLink.query)\n  dom.query.textContent = the.cosmicLink.query\n  networkUI.lock()\n\n  await the.cosmicLink.send()\n  redirectionUI.display(\"info\", \"Transaction validated\")\n  if (env.isEmbedded) parent.postMessage(\"close\", \"*\")\n  if (document.referrer) {\n    enableButton(dom.redirectionButton, \"Close\", () => history.back())\n  } else {\n    dom.redirectionButton.value = \"Done\"\n  }\n}\n\nredirectionUI.display = function (type, message) {\n  display(dom.redirectionMsgbox, type, message)\n}\n\nconst qrCodeUI = {}\n\nqrCodeUI.loadingAnim = function () {\n  html.rewrite(dom.qrCode, html.create(\"canvas\", \".cosmiclib_loadingAnim\"))\n}\n\nqrCodeUI.refresh = function (value) {\n  if (!the.authenticator.qrCode || !value) return\n\n  const canvas = html.create(\"canvas\")\n  QrCode.toCanvas(canvas, value, { margin: 0, scale: 4 })\n  canvas.title = value\n  html.rewrite(dom.qrCode, canvas)\n}\n\nqrCodeUI.switch = function () {\n  the.qrCode = localStorage.QR = !the.qrCode\n  if (the.qrCode) qrCodeUI.enable()\n  else qrCodeUI.disable()\n}\n\nqrCodeUI.enable = function () {\n  dom.qrButton.className = \"enabled\"\n  html.show(dom.qrCode)\n}\n\nqrCodeUI.disable = function () {\n  dom.qrButton.className = undefined\n  html.hide(dom.qrCode)\n}\n\n/**\n * HTML Elements Events\n */\n\ndom.redirectionButton.onclick = redirectionUI.click\ndom.qrButton.onclick = qrCodeUI.switch\n\ndom.redirectionCheckbox.onchange = function () {\n  the.redirect = localStorage.redirect = !the.redirect\n}\n"],"sourceRoot":""}